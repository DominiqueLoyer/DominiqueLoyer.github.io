<DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Animated Ontology Tree</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    .node { cursor: pointer; }
    .node circle { fill: #fff; stroke: steelblue; stroke-width: 3px; }
    .node text { font: 10px sans-serif; }
    .link { fill: none; stroke: #ccc; stroke-width: 2px; }
  </style>
</head>

<body>
  <h2>Researcher's Ontology</h2>
  <div id="tree-container"></div>
  <!-- Ici, nous définissons la structure JSON de l'ontologie -->
  <script>
    var treeData = {
      "name": "Ontologie Dominique Loyer",
      "children": [
        {
          "name": "Classes",
          "children": [
            {
              "name": ":Personne",
              "children": [
                { "name": "Individual: DominiqueS_Loyer" }
              ]
            },
            {
              "name": ":Organisation",
              "children": [
                { "name": "Individual: SherbrookeInformatiqueInc" }
              ]
            },
            {
              "name": ":Projet",
              "children": [
                { "name": "Individual: Projet1" },
                { "name": "Individual: Projet2" },
                { "name": "Individual: Projet3" },
                { "name": "Individual: Projet4" },
                { "name": "Individual: Projet5" },
                { "name": "Individual: Projet6" },
                { "name": "Individual: Projet7" },
                { "name": "Individual: Projet8" },
                { "name": "Individual: Projet9" },
                { "name": "Individual: Projet10" },
                { "name": "Individual: Projet11" },
                { "name": "Individual: Projet12" },
                { "name": "Individual: Projet13" }
              ]
            },
            {
              "name": ":Publication",
              "children": [
                {
                  "name": ":ArticleDeRevue",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Article de Revue\"" },
                    { "name": "Axiom: rdfs:comment \"Une publication évaluée par les pairs dans une revue scientifique ou académique.\"" }
                  ]
                },
                { "name": "Individual: Publication1" }
              ]
            },
            {
              "name": ":Conference",
              "children": [
                {
                  "name": ":ConferenceNationale",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Conférence Nationale\"" },
                    { "name": "Axiom: rdfs:comment \"Une conférence dont la portée et l'audience sont principalement nationales.\"" }
                  ]
                },
                {
                  "name": ":ConferenceInternationale",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Conférence Internationale\"" },
                    { "name": "Axiom: rdfs:comment \"Une conférence dont la portée et l'audience sont internationales.\"" }
                  ]
                },
                {
                  "name": ":Atelier",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Atelier\"" },
                    { "name": "Axiom: rdfs:comment \"Un événement plus petit et souvent plus interactif qu'une conférence formelle, parfois rattaché à une conférence plus grande.\"" }
                  ]
                },
                { "name": "Individual: Conference1" },
                { "name": "Individual: Conference2" },
                { "name": "Individual: Conference3" }
              ]
            },
            {
              "name": ":Lecture",
              "children": [
                {
                  "name": ":SousClasseLecture1",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 1\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture2",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 2\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture3",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 3\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture4",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 4\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture5",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 5\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture6",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 6\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture7",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 7\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture8",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 8\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture9",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 9\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture10",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 10\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture11",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 11\"" }
                  ]
                },
                {
                  "name": ":SousClasseLecture12",
                  "children": [
                    { "name": "Axiom: rdfs:label \"Sous-classe de Lecture 12\"" }
                  ]
                },
                { "name": "Individual: Lecture1" },
                { "name": "Individual: Lecture2" },
                { "name": "Individual: Lecture3" },
                { "name": "Individual: Lecture4" },
                { "name": "Individual: Lecture5" },
                { "name": "Individual: Lecture6" },
                { "name": "Individual: Lecture7" },
                { "name": "Individual: Lecture8" },
                { "name": "Individual: Lecture9" },
                { "name": "Individual: Lecture10" },
                { "name": "Individual: Lecture11" },
                { "name": "Individual: Lecture12" }
              ]
            }
          ]
        },
        {
          "name": "Properties",
          "children": [
            {
              "name": ":nom",
              "children": [
                { "name": "Domain: Personne, Organisation, Projet, Publication, Conference, Lecture" },
                { "name": "Range: xsd:string" }
              ]
            },
            {
              "name": ":email",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: xsd:string" }
              ]
            },
            {
              "name": ":orcid",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: xsd:string" }
              ]
            },
            {
              "name": ":telephone",
              "children": [
                { "name": "Domain: Personne, Organisation" },
                { "name": "Range: xsd:string" }
              ]
            },
            {
              "name": ":affilieA",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: Organisation" }
              ]
            },
            {
              "name": ":aProjet",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: Projet" }
              ]
            },
            {
              "name": ":estAuteurDePublication",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: Publication" }
              ]
            },
            {
              "name": ":publicationParAuteur",
              "children": [
                { "name": "Inverse of: :estAuteurDePublication" },
                { "name": "Domain: Publication" },
                { "name": "Range: Personne" }
              ]
            },
            {
              "name": ":aPresenteAConference",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: Conference" }
              ]
            },
            {
              "name": ":conferenceAvecPresentationDe",
              "children": [
                { "name": "Inverse of: :aPresenteAConference" },
                { "name": "Domain: Conference" },
                { "name": "Range: Personne" }
              ]
            },
            {
              "name": ":aDonneLecture",
              "children": [
                { "name": "Domain: Personne" },
                { "name": "Range: Lecture" }
              ]
            },
            {
              "name": ":lectureDonneePar",
              "children": [
                { "name": "Inverse of: :aDonneLecture" },
                { "name": "Domain: Lecture" },
                { "name": "Range: Personne" }
              ]
            }
          ]
        }
      ]
    };
  </script>
  
  <!-- Place the D3.js code that uses treeData here -->
  <script>
    // Dimensions and margins for the diagram
    var margin = {top: 20, right: 90, bottom: 30, left: 90},
        width = 1200 - margin.left - margin.right,
        height = 800 - margin.top - margin.bottom;

    // Append the SVG object to the container div.
    var svg = d3.select("#tree-container").append("svg")
        .attr("width", width + margin.right + margin.left)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var i = 0,
        duration = 750,
        root;

    // Create a tree layout and set its size.
    var treemap = d3.tree().size([height, width]);

    // Convert the JSON hierarchy into a D3 hierarchy.
    root = d3.hierarchy(treeData, function(d) { return d.children; });
    root.x0 = height / 2;
    root.y0 = 0;

    // No collapse at startup so all branches are visible.
    update(root);

    // Update the tree whenever nodes are toggled.
    function update(source) {
      var treeData = treemap(root);
      var nodes = treeData.descendants(),
          links = treeData.descendants().slice(1);

      // Normalize for fixed-depth.
      nodes.forEach(function(d){ d.y = d.depth * 180; });

      // ****************** Nodes section ***************************
      var node = svg.selectAll('g.node')
          .data(nodes, function(d) { return d.id || (d.id = ++i); });

      // Enter any new nodes at the parent's previous position.
      var nodeEnter = node.enter().append('g')
          .attr('class', 'node')
          .attr("transform", function(d) {
              return "translate(" + source.y0 + "," + source.x0 + ")";
          })
          .on('click', click);

      // Add circle for the nodes.
      nodeEnter.append('circle')
          .attr('class', 'node')
          .attr('r', 1e-6)
          .style("fill", function(d) {
              return d._children ? "lightsteelblue" : "#fff";
          });

      // Add labels for the nodes.
      nodeEnter.append('text')
          .attr("dy", ".35em")
          .attr("x", function(d) {
              return d.children || d._children ? -13 : 13;
          })
          .attr("text-anchor", function(d) {
              return d.children || d._children ? "end" : "start";
          })
          .text(function(d) { return d.data.name; });

      var nodeUpdate = nodeEnter.merge(node);

      nodeUpdate.transition()
          .duration(duration)
          .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

      nodeUpdate.select('circle.node')
          .attr('r', 10)
          .style("fill", function(d) {
              return d._children ? "lightsteelblue" : "#fff";
          })
          .attr('cursor', 'pointer');

      var nodeExit = node.exit().transition()
          .duration(duration)
          .attr("transform", function(d) {
              return "translate(" + source.y + "," + source.x + ")";
          })
          .remove();

      nodeExit.select('circle')
          .attr('r', 1e-6);

      nodeExit.select('text')
          .style('fill-opacity', 1e-6);

      // ****************** Links section ***************************
      var link = svg.selectAll('path.link')
          .data(links, function(d) { return d.id; });

      var linkEnter = link.enter().insert('path', "g")
          .attr("class", "link")
          .attr('d', function(d){
            var o = {x: source.x0, y: source.y0};
            return diagonal(o, o);
          });

      var linkUpdate = linkEnter.merge(link);

      linkUpdate.transition()
          .duration(duration)
          .attr('d', function(d){ return diagonal(d, d.parent); });

      var linkExit = link.exit().transition()
          .duration(duration)
          .attr('d', function(d) {
            var o = {x: source.x, y: source.y};
            return diagonal(o, o);
          })
          .remove();

      // Store the old positions for transition.
      nodes.forEach(function(d){
        d.x0 = d.x;
        d.y0 = d.y;
      });

      // Creates a curved (diagonal) path from parent to the child nodes.
      function diagonal(s, d) {
        var path = `M ${s.y} ${s.x}
                    C ${(s.y + d.y) / 2} ${s.x},
                      ${(s.y + d.y) / 2} ${d.x},
                      ${d.y} ${d.x}`;
        return path;
      }
    }

    // Toggle children on click.
    function click(event, d) {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
      update(d);
    }
  </script>
</body>
</html>
